{"version":3,"sources":["logoSTC.svg","App.js","reportWebVitals.js","index.js"],"names":["targetNetworkName","process","addrMigrator","initWeb3","provider","web3","Web3","eth","extend","methods","name","call","outputFormatter","utils","hexToNumber","providerOptions","walletconnect","package","WalletConnectProvider","options","infuraId","App","props","state","eula","web3Modal","Web3Modal","network","cacheProvider","a","this","connect","subscribeProvider","getAccounts","accounts","address","net","getId","networkId","chainId","evalStatus","BN","setState","connected","old_token","approve","pow","sub","send","from","on","migrator_contract","doSwap","console","log","Contract","ERC20","abi","new_token","STCSwapper","Promise","all","balanceOf","allowance","getBalance","migrationBonus","d","map","x","oldBalance","newBalance","oldAllowance","migratorETHBalance","migratorSTCV2Balance","I10E18","mul","eligibleForRefund","gte","canSwap","wasApproved","canMigratorRefund","window","location","reload","className","src","logoSTC","alt","Alert","variant","div","toString","fromWei","isZero","Button","size","onClick","bind","doApprove","onConnect","Component","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.bf32deab.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logoSTC.c5bc01c1.svg\";","import React, { Component } from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Alert from \"react-bootstrap/Alert\";\n\nimport Web3 from \"web3\";\nimport Web3Modal from \"web3modal\";\nimport WalletConnectProvider from \"@walletconnect/web3-provider\";\n\nimport ERC20 from \"@openzeppelin/contracts/build/contracts/ERC20.json\";\nimport STCSwapper from \"./abi/STCSwapper.json\";\n\nimport \"./App.css\";\nimport logoSTC from \"./logoSTC.svg\";\n\nconst targetNetworkID = +process.env.REACT_APP_TARGET_NETWORK_ID;\nconst targetNetworkName = process.env.REACT_APP_NETWORK_NAME;\nconst addrStcv1 = process.env.REACT_APP_ADDR_STCV1;\nconst addrStcv2 = process.env.REACT_APP_ADDR_STCV2;\nconst addrMigrator = process.env.REACT_APP_ADDR_MIGRATOR;\nconst infuraId = process.env.REACT_APP_INFURA_ID;\n\nfunction initWeb3(provider) {\n  const web3 = new Web3(provider);\n\n  web3.eth.extend({\n    methods: [\n      {\n        name: \"chainId\",\n        call: \"eth_chainId\",\n        outputFormatter: web3.utils.hexToNumber,\n      },\n    ],\n  });\n\n  return web3;\n}\n\nconst providerOptions = {\n  walletconnect: {\n    package: WalletConnectProvider,\n    options: {\n      infuraId,\n    },\n  },\n};\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { eula: false };\n    this.web3Modal = new Web3Modal({\n      network: targetNetworkName,\n      cacheProvider: false,\n      providerOptions: providerOptions,\n    });\n  }\n\n  async onConnect() {\n    const provider = await this.web3Modal.connect();\n    await this.subscribeProvider(provider);\n    const web3 = initWeb3(provider);\n\n    const accounts = await web3.eth.getAccounts();\n    const address = accounts[0];\n    const networkId = await web3.eth.net.getId();\n    const chainId = await web3.eth.chainId();\n\n    await this.evalStatus(address, networkId, web3);\n    const BN = web3.utils.BN.BN;\n\n    await this.setState({\n      web3,\n      BN: BN,\n      provider,\n      connected: true,\n      address,\n      chainId,\n      networkId,\n    });\n  }\n\n  async doApprove() {\n    const web3 = this.state.web3;\n    const BN = this.state.BN;\n    this.state.old_token.methods\n      .approve(addrMigrator, new BN(2).pow(new BN(256)).sub(new BN(1)))\n      .send({ from: this.state.address })\n      .on(\"confirmation\", () => {\n        this.evalStatus(this.state.address, this.state.networkId, web3);\n      });\n  }\n\n  async doSwap() {\n    const web3 = this.state.web3;\n    this.state.migrator_contract.methods\n      .doSwap()\n      .send({ from: this.state.address })\n      .on(\"confirmation\", () => {\n        console.log(\"confirmation\");\n        this.evalStatus(this.state.address, this.state.networkId, web3);\n      });\n  }\n\n  async evalStatus(address, networkId, web3) {\n    const BN = web3.utils.BN.BN;\n    if (networkId === targetNetworkID) {\n      const old_token = new web3.eth.Contract(ERC20.abi, addrStcv1);\n      const new_token = new web3.eth.Contract(ERC20.abi, addrStcv2);\n      const migrator_contract = new web3.eth.Contract(\n        STCSwapper.abi,\n        addrMigrator\n      );\n\n      const d = (\n        await Promise.all([\n          old_token.methods.balanceOf(address).call(),\n          new_token.methods.balanceOf(address).call(),\n          old_token.methods.allowance(address, addrMigrator).call(),\n          web3.eth.getBalance(addrMigrator),\n          migrator_contract.methods.migrationBonus().call(),\n          new_token.methods.balanceOf(addrMigrator).call(),\n        ])\n      ).map((x) => new BN(x));\n      const oldBalance = d[0];\n      const newBalance = d[1];\n      const oldAllowance = d[2];\n      const migratorETHBalance = d[3];\n      const migrationBonus = d[4];\n      const migratorSTCV2Balance = d[5];\n\n      const I10E18 = new BN(10 ** 10).mul(new BN(10 ** 8));\n      const eligibleForRefund = oldBalance.gte(new BN(1000000));\n      const canMigratorRefund = false; // TODO\n      const canSwap = migratorSTCV2Balance.gte(\n        oldBalance.mul(new BN(10 ** 10)).mul(new BN(10 ** 6))\n      );\n      const wasApproved = oldAllowance.gte(oldBalance);\n\n      this.setState({\n        migrator_contract,\n        old_token,\n        new_token,\n        oldBalance,\n        newBalance,\n        oldAllowance,\n        migratorETHBalance,\n        migrationBonus,\n        migratorSTCV2Balance,\n        eligibleForRefund,\n        canMigratorRefund,\n        canSwap,\n        wasApproved,\n        address,\n        I10E18,\n      });\n    }\n  }\n\n  subscribeProvider(provider) {\n    if (!provider.on) {\n      return;\n    }\n    provider.on(\"close\", () => {\n      window.location.reload(false);\n    });\n    provider.on(\"accountsChanged\", async (accounts) => {\n      console.log(accounts);\n      const address = accounts[0];\n      await this.evalStatus(address, this.state.networkId, this.state.web3);\n    });\n    /* TODO: Make is saner - don't reload the app... */\n    provider.on(\"chainChanged\", async () => {\n      window.location.reload(false);\n    });\n    provider.on(\"networkChanged\", async () => {\n      window.location.reload(false);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n        <div className=\"wrapper\">\n          <div></div>\n          <div></div>\n          <div></div>\n          <div></div>\n          <div>\n            <img src={logoSTC} className=\"App-logo\" alt=\"logo\" />\n            <div className=\"App-logo-text\">\n              <h2>STCV2 Token migration</h2>\n              {!this.state.eula ? (\n                <div>\n                  <div className=\"App-eula\">\n                    <ol>\n                      <li>\n                        {\" \"}\n                        Only access this app if you&aposre a holder of STCV1{\" \"}\n                      </li>\n                      <li>\n                        {\" \"}\n                        NEVER send STCV1 directly to the migration contract{\" \"}\n                      </li>\n                      <li> If you disregarded 2) then contact STC support </li>\n                      <li>\n                        {\" \"}\n                        You need to have ETH in your wallet in order to swap\n                        STCV1 for STCV2{\" \"}\n                      </li>\n                      <li> The swap is irreversible </li>\n                      <li>\n                        {\" \"}\n                        We will swap all of your STCV1 - smaller swaps are\n                        disallowed{\" \"}\n                      </li>\n                      <li> We will ask you to perform 2 ETH transactions </li>\n                      <li>\n                        {\" \"}\n                        When swapping more than 10k STCV1 you will receive a\n                        full/partial gas refund for both transactions{\" \"}\n                      </li>\n                      <li>\n                        {\" \"}\n                        The migration bonus might be changed at any time - right\n                        now the gas refund is 0.01 ETH{\" \"}\n                      </li>\n                    </ol>\n                  </div>\n                  <Button\n                    variant=\"warning\"\n                    size=\"lg\"\n                    onClick={() => {\n                      this.setState({ eula: true });\n                    }}\n                  >\n                    I understand what I&aposm doing\n                  </Button>\n                </div>\n              ) : !this.state.connected ? (\n                <div>\n                  <Button\n                    variant=\"success\"\n                    size=\"lg\"\n                    onClick={this.onConnect.bind(this)}\n                  >\n                    Connect wallet\n                  </Button>\n                </div>\n              ) : this.state.chainId !== targetNetworkID ? (\n                <Alert variant=\"danger\">\n                  {\" \"}\n                  Unsupported network id! Please switch to {\n                    targetNetworkName\n                  }{\" \"}\n                </Alert>\n              ) : (\n                <div>\n                  <div> Double check that you use the correct account </div>\n                  <div> Connected account: {this.state.address} </div>\n                  <div>\n                    {\" \"}\n                    STCV1 balance:{\" \"}\n                    {this.state.oldBalance\n                      .div(new this.state.BN(10 ** 2))\n                      .toString()}{\" \"}\n                  </div>\n                  <div>\n                    {\" \"}\n                    STCV2 balance:{\" \"}\n                    {this.state.newBalance\n                      .div(this.state.I10E18)\n                      .toString()}{\" \"}\n                  </div>\n                  <div>\n                    {\" \"}\n                    Migrators STCV1 allowance:{\" \"}\n                    {this.state.wasApproved ? \"OK\" : \"Insufficient\"}\n                  </div>\n                  <div>\n                    {\" \"}\n                    STCV2 available swap supply:{\" \"}\n                    {this.state.web3.utils.fromWei(\n                      this.state.migratorSTCV2Balance\n                    )}{\" \"}\n                  </div>\n                  <div>\n                    ETH refund pool:{\" \"}\n                    {this.state.web3.utils.fromWei(\n                      this.state.migratorETHBalance\n                    )}{\" \"}\n                    ETH\n                  </div>\n                  <div>\n                    Current migration bonus:{\" \"}\n                    {this.state.web3.utils.fromWei(this.state.migrationBonus)}{\" \"}\n                    ETH\n                  </div>\n                  <div>\n                    {this.state.migrationBonus.isZero()\n                      ? \"Migration bonus was disabled by STC - subsidies ended\"\n                      : this.state.eligibleForRefund\n                      ? \"Eligible for gas refund - at the end of the migration you will receive a small ETH refund\"\n                      : \"You're not eligible for a gas refund - you hold less than 10k STCV1\"}\n                  </div>\n\n                  {this.state.oldBalance.isZero() ? (\n                    <Alert variant=\"success\">\n                      You don t hold any STCV1 tokens\n                    </Alert>\n                  ) : !this.state.canSwap ? (\n                    <Alert variant=\"danger\">\n                      {\" \"}\n                      Migration contract has insufficient STCV2 - contact STC\n                      support.{\" \"}\n                    </Alert>\n                  ) : !this.state.wasApproved ? (\n                    <div>\n                      <Button\n                        variant=\"success\"\n                        size=\"lg\"\n                        onClick={this.doApprove.bind(this)}\n                      >\n                        Approve swap?\n                      </Button>\n                      <div>\n                        {\" \"}\n                        In case the approval got confirmed and the app\n                        didn&apost acknowledge that then reload the Dapp{\" \"}\n                      </div>\n                    </div>\n                  ) : (\n                    <Button\n                      variant=\"success\"\n                      size=\"lg\"\n                      onClick={this.doSwap.bind(this)}\n                    >\n                      Swap STCV1 for STCV2?\n                    </Button>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n          <div></div>\n          <div></div>\n          <div></div>\n          <div></div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n","const reportWebVitals = (onPerfEntry) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}